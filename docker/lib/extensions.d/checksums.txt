# Extension Download Checksums
# Part of Sindri security hardening initiative (C2 fix)
# Format: SHA256 URL
#
# ==============================================================================
# HYBRID SECURITY APPROACH (Option 1)
# ==============================================================================
#
# Sindri uses a hybrid approach to secure downloads:
#
# 1. STATIC DOWNLOADS (GPG keys, pinned binaries):
#    - Full checksum verification via secure_download()
#    - Checksums documented below
#    - Most critical for supply chain security
#
# 2. DYNAMIC INSTALLERS (self-updating scripts):
#    - HTTPS+TLS1.2 enforcement (--proto '=https' --tlsv1.2)
#    - Standardized timeouts (--max-time 120 --connect-timeout 30)
#    - Documented accepted risk
#    - Official domains only
#
# This approach balances security with maintainability:
# ✅ Critical GPG keys verified with checksums
# ✅ All downloads enforce HTTPS+TLS1.2
# ✅ Standardized timeout protection
# ⚠️  Dynamic installers accepted risk (documented below)
#
# ==============================================================================
# STATIC DOWNLOADS - Checksum Verified
# ==============================================================================
#
# To generate checksums:
#   curl -sL <URL> | sha256sum
#
# To update this file when versions change:
#   1. Download the file manually and verify it's legitimate
#   2. Generate the checksum
#   3. Update this file
#   4. Test the extension installation
#
# Format: SHA256_CHECKSUM URL
#
# NOTE: Checksums below are placeholders - generate real checksums before production use!
# Generate with: curl --proto '=https' --tlsv1.2 -fsSL <URL> | sha256sum

# Docker Extension - GPG Keys
# PLACEHOLDER_CHECKSUM_docker_gpg https://download.docker.com/linux/ubuntu/gpg

# Infrastructure Tools - GPG Keys
# PLACEHOLDER_CHECKSUM_hashicorp_gpg https://apt.releases.hashicorp.com/gpg

# Cloud Tools - GPG Keys
# PLACEHOLDER_CHECKSUM_gcloud_gpg https://packages.cloud.google.com/apt/doc/apt-key.gpg

# Docker Extension - Pinned Binaries
# PLACEHOLDER_CHECKSUM_docker_compose_v2.39.2 https://github.com/docker/compose/releases/download/v2.39.2/docker-compose-Linux-x86_64
# PLACEHOLDER_CHECKSUM_dive_v0.13.1 https://github.com/wagoodman/dive/releases/download/v0.13.1/dive_0.13.1_linux_amd64.deb
# PLACEHOLDER_CHECKSUM_ctop_v0.7.7 https://github.com/bcicen/ctop/releases/download/v0.7.7/ctop-0.7.7-linux-amd64

# To generate actual checksums for production:
# curl --proto '=https' --tlsv1.2 -fsSL https://download.docker.com/linux/ubuntu/gpg | sha256sum
# curl --proto '=https' --tlsv1.2 -fsSL https://apt.releases.hashicorp.com/gpg | sha256sum
# curl --proto '=https' --tlsv1.2 -fsSL https://packages.cloud.google.com/apt/doc/apt-key.gpg | sha256sum

# ==============================================================================
# DYNAMIC INSTALLERS - HTTPS Enforcement Only (Accepted Risk)
# ==============================================================================
#
# The following installers update frequently and checksum verification is not
# practical. These use HTTPS+TLS1.2 enforcement as primary security control.
#
# All enforce: --proto '=https' --tlsv1.2 --max-time 120 --connect-timeout 30
#
# Dynamic Installers (with rationale):
# - https://get.sdkman.io                           # SDKMAN (JVM) - updates weekly
# - https://aka.ms/InstallAzureCLIDeb               # Azure CLI - Microsoft's latest
# - https://raw.githubusercontent.com/oracle/oci-cli/master/scripts/install/install.sh  # Oracle OCI
# - https://clis.cloud.ibm.com/install/linux        # IBM Cloud CLI
# - https://ollama.com/install.sh                   # Ollama - AI model runner
# - https://get.symfony.com/cli/installer           # Symfony CLI
# - https://astral.sh/uv/install.sh                 # uv Python package manager
# - https://carvel.dev/install.sh                   # Carvel tools
# - https://raw.githubusercontent.com/crossplane/crossplane/master/install.sh  # Crossplane
# - https://get.pulumi.com                          # Pulumi IaC
# - https://raw.githubusercontent.com/helm/helm/main/scripts/get-helm-3  # Helm package manager
#
# Risk Mitigation Strategy:
# 1. HTTPS+TLS1.2 enforcement prevents MITM attacks
# 2. Timeouts prevent hanging/resource exhaustion
# 3. Official domains only (verified via URL validation)
# 4. Secure temp files prevent data leakage
# 5. Extensions run as non-root user (limited blast radius)
# 6. Sudo access restricted to specific commands only
#
# Risk Acceptance:
# - Dynamic installers may change without notice
# - Upstream compromise could affect installations
# - Trade-off: Security vs. maintainability and up-to-date tools
# - Accepted for development environments with layered defenses
#
# ==============================================================================
# USAGE PATTERNS FOR EXTENSION DEVELOPERS
# ==============================================================================
#
# 1. For STATIC downloads with checksum:
#    source /docker/lib/extension-helpers.sh
#    checksum=$(get_checksum "https://example.com/file.gpg")
#    if [[ -n "$checksum" ]]; then
#      secure_download "https://example.com/file.gpg" "$checksum" "/tmp/file.gpg"
#    else
#      # Fallback to HTTPS enforcement
#      curl --proto '=https' --tlsv1.2 -fsSL --max-time 120 --connect-timeout 30 \
#        "https://example.com/file.gpg" -o "/tmp/file.gpg"
#    fi
#
# 2. For DYNAMIC installers (accepted risk):
#    # Document why it's dynamic and mitigation strategy
#    # SECURITY: Dynamic installer (C2 fix - accepted risk with HTTPS enforcement)
#    # Note: <explanation of why checksum not practical>
#    # Mitigation: HTTPS+TLS1.2 enforcement, timeout limits, official domain
#    curl --proto '=https' --tlsv1.2 -fsSL \
#      --max-time 120 --connect-timeout 30 \
#      "https://official.domain/install.sh" | bash
#
# 3. For GPG keys (highest priority for verification):
#    checksum=$(get_checksum "$gpg_url")
#    if [[ -n "$checksum" ]]; then
#      temp_gpg=$(create_secure_temp_file)
#      setup_cleanup_trap "$temp_gpg"
#      secure_download "$gpg_url" "$checksum" "$temp_gpg"
#      sudo gpg --dearmor -o /etc/apt/keyrings/key.gpg < "$temp_gpg"
#    fi
#
# 4. For binaries with secure temp files:
#    temp_bin=$(create_secure_temp_file)
#    setup_cleanup_trap "$temp_bin"
#    curl --proto '=https' --tlsv1.2 -fsSL --max-time 120 --connect-timeout 30 \
#      -o "$temp_bin" "https://example.com/binary"
#    chmod +x "$temp_bin"
#    sudo mv "$temp_bin" /usr/local/bin/tool
#
# ==============================================================================
# SECURITY REMINDERS
# ==============================================================================
#
# - Always use HTTPS URLs (enforced by --proto '=https')
# - Minimum TLS 1.2 (enforced by --tlsv1.2)
# - Always set timeouts (--max-time 120 --connect-timeout 30)
# - Use secure temp files (create_secure_temp_file, create_secure_temp_dir)
# - Setup cleanup traps (setup_cleanup_trap)
# - Verify checksums for GPG keys (highest priority)
# - Document accepted risks for dynamic installers
# - Test after every update
